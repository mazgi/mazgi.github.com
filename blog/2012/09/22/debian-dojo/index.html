
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>「第0回Debianパッケージング道場」に行ってきました - log++</title>
  <meta name="author" content="mazgi">

  
  <meta name="description" content="9/22(土)に楽天さんで第0回Debianパッケージング道場 on Zusaarが開催されたので行ってきました。
Debianド素人として大いにハマってきた様をレポートしてみます。 参加するまで 参加の動機とか 最近仕事でDebian GNU/Linuxを触りはじめたので「 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mazgi.github.com/blog/2012/09/22/debian-dojo">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="log++" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">log++</a></h1>
  
    <h2>Yes, I will</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mazgi.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">「第0回Debianパッケージング道場」に行ってきました</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-22T16:54:00+09:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>9/22(土)に楽天さんで<a href="http://www.zusaar.com/event/355109">第0回Debianパッケージング道場 on Zusaar</a>が開催されたので行ってきました。<br/>
Debianド素人として大いにハマってきた様をレポートしてみます。</p>

<h1>参加するまで</h1>

<h2>参加の動機とか</h2>

<p>最近仕事でDebian GNU/Linuxを触りはじめたので「社内用に最新バージョンやpatch適用済みのパッケージ作れたらな」という軽い気持ちです。
DebianにはRuby1.9.3のパッケージがなさそうだった <em>(※<a href="http://packages.debian.org/ja/sid/libruby">libruby</a>というパッケージがあるようです)</em> ので、「ちょっとパッケージ作ってみるか」とか考えてました。</p>

<h2>準備したこと</h2>

<p>前日になってバタバタとMacBook Air上のVirtualBoxにDebian GNU/Linuxをインストールしました。</p>

<ul>
<li>Debian squeezeインストール</li>
</ul>


<p><img src="/images/2012-09-22-debian-dojo/20120922_debian_squeeze_installed.png"></p>

<p><em>&#8220;使うパソコンで Debian / unstable が動作する環境を整えてください。&#8221;</em> とのことだったので、VirtualBoxに <strong>Debian squeeze</strong> をインストールしました <em>(※後述、unstableが何たるかを理解していませんでした)</em> 。<br/>
インストール自体はISOイメージファイルから普通に行いました。パーティションを手動で切ったくらいなので手順は省きます。</p>

<ul>
<li>sshd設定</li>
</ul>


<p>Macから <code>ssh xxx.local</code> したかったので <strong>SSHデーモン</strong> と <strong>Avahi</strong> を入れました。<br/>
sshdのパッケージ名、sshなんですね。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install avahi-daemon
</span><span class='line'># apt-get install ssh</span></code></pre></td></tr></table></div></figure>


<ul>
<li>開発ツールインストール</li>
</ul>


<p><em>&#8220;Debian / unstable に 最低限のビルド環境を構築してください。sudo apt-get install packaging-dev&#8221;</em> とのことだったので <code>packaging-dev</code> をインストールしようとしたのですが…</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install packaging-dev
</span><span class='line'>パッケージリストを読み込んでいます... 完了
</span><span class='line'>依存関係ツリーを作成しています                
</span><span class='line'>状態情報を読み取っています... 完了
</span><span class='line'>E: パッケージ packaging-dev が見つかりません</span></code></pre></td></tr></table></div></figure>


<p>…なぜかパッケージが見つかりません <em>(※後述)</em> 。<br/>
仕方ないので保留して <code>build-essential</code> だけ入れておきました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-get install build-essential</span></code></pre></td></tr></table></div></figure>


<h1>当日</h1>

<p>当日は、午前中ハンズオン、午後から黙々とハッカソンっぽい感じで進みました。<br/>
ハンズオン形式で <a href="https://twitter.com/iwamatsu">@iwamatsu</a> 先生が用意してくださったサンプルをDebianパッケージにしていきます。</p>

<h3>ネットワーク</h3>

<p>VirtualBoxのネットワーク設定をブリッジにしていたのですが、IPアドレスがもらえませんでした(ありがち)。<br/>
慌てて仮想NICを追加！</p>

<p><img src="/images/2012-09-22-debian-dojo/20120922_add_virtual_nic.png"></p>

<h2>作業をはじめる前の準備</h2>

<ul>
<li>パッケージメンテナ名の設定</li>
</ul>


<p>パッケージメンテナの名前 <code>DEBFULLNAME</code> と メールアドレス <code>DEBEMAIL</code> を環境変数として設定しましょうとのこと。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>￼export DEBFULLNAME="Yasuo IWAKURA"
</span><span class='line'>export DEBEMAIL="Y.I@wired.example.com"</span></code></pre></td></tr></table></div></figure>


<p>本来は <code>∼/.bashrc</code> などに書くようです。<br/>
私はネットワークの設定しててこれをすっとばしたのであとでちょっと悩むことになります  <em>(※後述)</em> 。</p>

<ul>
<li><code>packaging-dev</code> のインストール</li>
</ul>


<p>これはメタパッケージで、インストールDebianパッケージをパッケージングするのに必要な各種パッケージが入るとのこと。<br/>
…が、Debian squeezeではパッケージが見つかりません…！</p>

<h3>unstableについて</h3>

<p>パッケージ作るためにはDebian unstableが必要で、これはどうやらディストリビューションのtrunkバージョンのようなものに当たるようです。<br/>
どうりでISOイメージが提供されていないはずです…。</p>

<p>ということでDebian squeezeをunstableにする方法を教えていただきました。<br/>
ちなみにunstableのコードネームは常にsidだそうで、これはtoystoryのワルガキに由来するそうです。</p>

<p><code>sources.list</code> に下記の2行だけ書いて、他の行をコメントアウトします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-squeeze:~# cat /etc/apt/sources.list
</span><span class='line'>...
</span><span class='line'>deb http://ftp.jaist.ac.jp/pub/Linux/Debian/ sid main
</span><span class='line'>deb-src http://ftp.jaist.ac.jp/pub/Linux/Debian/ sid main
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>アップグレードします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-squeeze:~# apt-get update
</span><span class='line'>root@debian-squeeze:~# apt-get upgrade
</span><span class='line'>root@debian-squeeze:~# apt-get dist-upgrade</span></code></pre></td></tr></table></div></figure>


<p>ついでにホスト名も変えました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat /etc/hostname 
</span><span class='line'>debian-sid</span></code></pre></td></tr></table></div></figure>


<p>sidにアップグレードしたら、無事 <code>packaging-dev</code> がインストールできました！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># apt-cache search packaging-dev
</span><span class='line'>packaging-dev - パッケージ開発のための便利なツール群
</span><span class='line'>root@debian-sid:~# apt-get install packaging-dev</span></code></pre></td></tr></table></div></figure>


<h2>サンプルパッケージ作成</h2>

<p>Debian unstable環境ができたので、周りの皆様に遅れながらも <a href="https://twitter.com/iwamatsu">@iwamatsu</a> 先生が用意してくださったサンプルパッケージをパッケージングします。</p>

<h3>まずビルドしてみる</h3>

<p>tarballを取得して展開します。<br/>
<em>※なお、tarballのダウンロードURLは、永続的なものか分からなかったため仮のものに置き換えています。</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~# mkdir -p ~/debian/dojo/work
</span><span class='line'>root@debian-sid:~# cd ~/debian/dojo/work/
</span><span class='line'>root@debian-sid:~/debian/dojo/work# wget http://experiments.example.com/hello-cwidget-20120922.tar.gz
</span><span class='line'>root@debian-sid:~/debian/dojo/work# tar xvf hello-cwidget-20120922.tar.gz 
</span><span class='line'>hello-cwidget-20120922/
</span><span class='line'>hello-cwidget-20120922/README
</span><span class='line'>hello-cwidget-20120922/config.h.in
</span><span class='line'>hello-cwidget-20120922/COPYING
</span><span class='line'>hello-cwidget-20120922/NEWS
</span><span class='line'>hello-cwidget-20120922/NOTE
</span><span class='line'>hello-cwidget-20120922/Makefile.in
</span><span class='line'>hello-cwidget-20120922/install-sh
</span><span class='line'>hello-cwidget-20120922/Makefile.am
</span><span class='line'>hello-cwidget-20120922/depcomp
</span><span class='line'>hello-cwidget-20120922/missing
</span><span class='line'>hello-cwidget-20120922/configure.in
</span><span class='line'>hello-cwidget-20120922/AUTHORS
</span><span class='line'>hello-cwidget-20120922/configure
</span><span class='line'>hello-cwidget-20120922/INSTALL
</span><span class='line'>hello-cwidget-20120922/hello-cwidget.cc
</span><span class='line'>hello-cwidget-20120922/autoscan.log
</span><span class='line'>hello-cwidget-20120922/ChangeLog
</span><span class='line'>hello-cwidget-20120922/aclocal.m4</span></code></pre></td></tr></table></div></figure>


<p>続いてconfigureしてみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work# cd hello-cwidget-20120922/
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ./configure 
</span><span class='line'>checking for a BSD-compatible install... /usr/bin/install -c
</span><span class='line'>checking whether build environment is sane... yes
</span><span class='line'>checking for a thread-safe mkdir -p... /bin/mkdir -p
</span><span class='line'>checking for gawk... no
</span><span class='line'>checking for mawk... mawk
</span><span class='line'>checking whether make sets $(MAKE)... yes
</span><span class='line'>checking for gcc... gcc
</span><span class='line'>checking whether the C compiler works... yes
</span><span class='line'>checking for C compiler default output file name... a.out
</span><span class='line'>checking for suffix of executables... 
</span><span class='line'>checking whether we are cross compiling... no
</span><span class='line'>checking for suffix of object files... o
</span><span class='line'>checking whether we are using the GNU C compiler... yes
</span><span class='line'>checking whether gcc accepts -g... yes
</span><span class='line'>checking for gcc option to accept ISO C89... none needed
</span><span class='line'>checking for style of include used by make... GNU
</span><span class='line'>checking dependency style of gcc... gcc3
</span><span class='line'>checking for g++... g++
</span><span class='line'>checking whether we are using the GNU C++ compiler... yes
</span><span class='line'>checking whether g++ accepts -g... yes
</span><span class='line'>checking dependency style of g++... gcc3
</span><span class='line'>checking for pkg-config... no
</span><span class='line'>checking for SIGC... no
</span><span class='line'>configure: error: in `/root/debian/dojo/work/hello-cwidget-20120922':
</span><span class='line'>configure: error: The pkg-config script could not be found or is too old.  Make sure it
</span><span class='line'>is in your PATH or set the PKG_CONFIG environment variable to the full
</span><span class='line'>path to pkg-config.
</span><span class='line'>
</span><span class='line'>Alternatively, you may set the environment variables SIGC_CFLAGS
</span><span class='line'>and SIGC_LIBS to avoid the need to call pkg-config.
</span><span class='line'>See the pkg-config man page for more details.
</span><span class='line'>
</span><span class='line'>To get pkg-config, see &lt;http://pkg-config.freedesktop.org/&gt;.
</span><span class='line'>See `config.log' for more details</span></code></pre></td></tr></table></div></figure>


<p><code>pkg-config</code> が足りないと言われてしまいました。<br/>
<code>pkg-config</code> が含まれるパッケージを探してインストールします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-file search pkg-config
</span><span class='line'>...
</span><span class='line'>pkg-config: /usr/bin/pkg-config
</span><span class='line'>
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-get install pkg-config</span></code></pre></td></tr></table></div></figure>


<p>再度configureします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ./configure
</span><span class='line'>...
</span><span class='line'>checking for pkg-config... /usr/bin/pkg-config
</span><span class='line'>checking pkg-config is at least version 0.9.0... yes
</span><span class='line'>checking for SIGC... no
</span><span class='line'>configure: error: Package requirements (sigc++-2.0) were not met:
</span><span class='line'>
</span><span class='line'>No package 'sigc++-2.0' found
</span><span class='line'>
</span><span class='line'>Consider adjusting the PKG_CONFIG_PATH environment variable if you
</span><span class='line'>installed software in a non-standard prefix.
</span><span class='line'>
</span><span class='line'>Alternatively, you may set the environment variables SIGC_CFLAGS
</span><span class='line'>and SIGC_LIBS to avoid the need to call pkg-config.
</span><span class='line'>See the pkg-config man page for more details.</span></code></pre></td></tr></table></div></figure>


<p>今度は<code>sigc++-2.0</code>が足りないようです。<br/>
<code>sigc++-2.0</code>が含まれるパッケージを探してインストールします。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-file search sigc++-2.0 | more
</span><span class='line'>libsigc++-2.0-0c2a: /usr/share/doc/libsigc++-2.0-0c2a/changelog.Debian.gz
</span><span class='line'>libsigc++-2.0-0c2a: /usr/share/doc/libsigc++-2.0-0c2a/changelog.gz
</span><span class='line'>libsigc++-2.0-0c2a: /usr/share/doc/libsigc++-2.0-0c2a/copyright
</span><span class='line'>libsigc++-2.0-dev: /usr/include/sigc++-2.0/sigc++/adaptors/adaptor_trait.h
</span><span class='line'>libsigc++-2.0-dev: /usr/include/sigc++-2.0/sigc++/adaptors/adaptors.h
</span><span class='line'>...
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-get install libsigc++-2.0-dev</span></code></pre></td></tr></table></div></figure>


<p>再度（ry</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ./configure 
</span><span class='line'>checking for SIGC... yes
</span><span class='line'>checking for CWIDGET... no
</span><span class='line'>configure: error: Package requirements (cwidget) were not met:
</span><span class='line'>
</span><span class='line'>No package 'cwidget' found
</span><span class='line'>
</span><span class='line'>Consider adjusting the PKG_CONFIG_PATH environment variable if you
</span><span class='line'>installed software in a non-standard prefix.
</span><span class='line'>
</span><span class='line'>Alternatively, you may set the environment variables CWIDGET_CFLAGS
</span><span class='line'>and CWIDGET_LIBS to avoid the need to call pkg-config.
</span><span class='line'>See the pkg-config man page for more details.</span></code></pre></td></tr></table></div></figure>


<p>こんどは<code>cwidget</code>が（ry<br/>
めんどくさくなったのでパッケージ名だけ表示して当たりをつけてみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-file search cwidget | cut -d ' ' -f 1 | sort -u
</span><span class='line'>chirp:
</span><span class='line'>d-rats:
</span><span class='line'>evolution-dev:
</span><span class='line'>libcwidget-dev:
</span><span class='line'>libcwidget-doc:
</span><span class='line'>libcwidget3-dbg:
</span><span class='line'>libcwidget3:
</span><span class='line'>libevolution:
</span><span class='line'>libmac-widgets-doc:
</span><span class='line'>qt4-doc-html:
</span><span class='line'>zabbix-frontend-php:
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-get install libcwidget-dev</span></code></pre></td></tr></table></div></figure>


<p>こんどこそ！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ./configure
</span><span class='line'>...
</span><span class='line'>checking for pkg-config... /usr/bin/pkg-config
</span><span class='line'>checking pkg-config is at least version 0.9.0... yes
</span><span class='line'>checking for SIGC... yes
</span><span class='line'>checking for CWIDGET... yes
</span><span class='line'>configure: creating ./config.status
</span><span class='line'>config.status: creating config.h
</span><span class='line'>config.status: executing depfiles commands
</span><span class='line'>configure: creating ./config.status
</span><span class='line'>config.status: creating Makefile
</span><span class='line'>config.status: creating config.h
</span><span class='line'>config.status: config.h is unchanged
</span><span class='line'>config.status: executing depfiles commands
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# make
</span><span class='line'>make  all-am
</span><span class='line'>make[1]: ディレクトリ `/root/debian/dojo/work/hello-cwidget-20120922' に入ります
</span><span class='line'>make[1]: ディレクトリ `/root/debian/dojo/work/hello-cwidget-20120922' から出ます
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ./hello-cwidget </span></code></pre></td></tr></table></div></figure>


<p>やっとconfigure成功です！</p>

<h3>パッケージにしてみる</h3>

<p>configureまでできることを確認したところで、今回はmakeを端折ってパッケージングします。<br/>
もちろん本来はmakeしてプログラム単体での動作確認を行うべきでしょうが、この時点でかなり遅れてたので省いてしまいました。</p>

<p>まず、tarballを展開し直します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cd ..
</span><span class='line'>root@debian-sid:~/debian/dojo/work# rm -rf hello-cwidget-20120922
</span><span class='line'>root@debian-sid:~/debian/dojo/work# tar xvf hello-cwidget-20120922.tar.gz 
</span><span class='line'>root@debian-sid:~/debian/dojo/work# cd hello-cwidget-20120922/</span></code></pre></td></tr></table></div></figure>


<p><code>dh-make</code>を入れます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# apt-get install dh-make</span></code></pre></td></tr></table></div></figure>


<p><code>dh-make</code>を実行します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# dh_make --createorig -s
</span><span class='line'>Maintainer name  : root
</span><span class='line'>Email-Address    : root@debian-squeeze.mobile.mazgi.com 
</span><span class='line'>Date             : Sat, 22 Sep 2012 11:53:58 +0900
</span><span class='line'>Package Name     : hello-cwidget
</span><span class='line'>Version          : 20120922
</span><span class='line'>License          : blank
</span><span class='line'>Type of Package  : Single
</span><span class='line'>Hit &lt;enter&gt; to confirm: ^C</span></code></pre></td></tr></table></div></figure>


<p>すると…なんということでしょう！<br/>
メンテナ名とメールアドレスがめちゃくちゃではないですか!!</p>

<p>慌てて<code>DEBFULLNAME</code>と<code>DEBEMAIL</code>を設定します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# export DEBFULLNAME="Hidenori MATSUKI"
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# export DEBEMAIL="MATSUKI.Hidenori@gmail.com"
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# dh_make --createorig -s
</span><span class='line'>Maintainer name  : Hidenori MATSUKI
</span><span class='line'>Email-Address    : MATSUKI.Hidenori@gmail.com 
</span><span class='line'>Date             : Sat, 22 Sep 2012 11:56:51 +0900
</span><span class='line'>Package Name     : hello-cwidget
</span><span class='line'>Version          : 20120922
</span><span class='line'>License          : blank
</span><span class='line'>Type of Package  : Single
</span><span class='line'>Hit &lt;enter&gt; to confirm: 
</span><span class='line'>Done. Please edit the files in the debian/ subdirectory now. hello-cwidget
</span><span class='line'>uses a configure script, so you probably don't have to edit the Makefiles.</span></code></pre></td></tr></table></div></figure>


<p><code>dh_make</code> を実行するとdebianディレクトリが作成されるようです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# tree 
</span><span class='line'>.
</span><span class='line'>├── AUTHORS
</span><span class='line'>...
</span><span class='line'>├── configure.in
</span><span class='line'>├── debian
</span><span class='line'>│   ├── README.Debian
</span><span class='line'>│   ├── README.source
</span><span class='line'>│   ├── changelog
</span><span class='line'>│   ├── compat
</span><span class='line'>│   ├── control
</span><span class='line'>│   ├── copyright
</span><span class='line'>│   ├── docs
</span><span class='line'>│   ├── emacsen-install.ex
</span><span class='line'>│   ├── emacsen-remove.ex
</span><span class='line'>│   ├── emacsen-startup.ex
</span><span class='line'>│   ├── hello-cwidget.cron.d.ex
</span><span class='line'>│   ├── hello-cwidget.default.ex
</span><span class='line'>│   ├── hello-cwidget.doc-base.EX
</span><span class='line'>│   ├── init.d.ex
</span><span class='line'>│   ├── manpage.1.ex
</span><span class='line'>│   ├── manpage.sgml.ex
</span><span class='line'>│   ├── manpage.xml.ex
</span><span class='line'>│   ├── menu.ex
</span><span class='line'>│   ├── postinst.ex
</span><span class='line'>│   ├── postrm.ex
</span><span class='line'>│   ├── preinst.ex
</span><span class='line'>│   ├── prerm.ex
</span><span class='line'>│   ├── rules
</span><span class='line'>│   ├── source
</span><span class='line'>│   │   └── format
</span><span class='line'>│   └── watch.ex
</span><span class='line'>├── depcomp
</span><span class='line'>…
</span><span class='line'>
</span><span class='line'>2 directories, 43 files</span></code></pre></td></tr></table></div></figure>


<p>debianディレクトリ内のファイルで、今回パッケージを作成するにあたって不要なものを削除します。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# rm debian/*.ex debian/*.EX debian/README.Debian debian/README.source debian/docs
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# tree 
</span><span class='line'>.
</span><span class='line'>├── AUTHORS
</span><span class='line'>…
</span><span class='line'>├── configure.in
</span><span class='line'>├── debian
</span><span class='line'>│   ├── changelog
</span><span class='line'>│   ├── compat
</span><span class='line'>│   ├── control
</span><span class='line'>│   ├── copyright
</span><span class='line'>│   ├── rules
</span><span class='line'>│   └── source
</span><span class='line'>│       └── format
</span><span class='line'>├── depcomp
</span><span class='line'>…
</span><span class='line'>
</span><span class='line'>2 directories, 24 files
</span></code></pre></td></tr></table></div></figure>


<p>開発環境では <code>debi</code> コマンドでインストールできるようですので、インストールして実行してみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# debi 
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# which hello-cwidget 
</span><span class='line'>/usr/bin/hello-cwidget
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# hello-cwidget </span></code></pre></td></tr></table></div></figure>


<p><img src="/images/2012-09-22-debian-dojo/20120922_hello-cwidget_01.png"></p>

<p>無事実行できました！</p>

<h4><em>dh_makeのオプションについて</em></h4>

<p>各オプションの意味を<code>man dh_make</code>でみるとそれぞれ下記の意味を持つようです。<br/>
<code>-s</code> は単体のプログラム用、</p>

<blockquote><p>-s, &#8211;single<br/>
Automatically set the package class to Single binary, skipping the question.</p></blockquote>

<p><code>--createorig</code> はオリジナルをtarballとして保存してくれる。</p>

<blockquote><p>If no -f is supplied either but &#8211;createorig is, the current  directory  is  created into  a news archive ../<packagename>-<version>.orig.tar.gz The original archive is needed for other Debian tools to generate the diffs to the original</p></blockquote>

<h2>パッケージのビルドテスト</h2>

<p><code>pbuilder</code> というツールを使うと、chroot環境のsandbox上でパッケージのビルドを検証できるようです。<br/>
このツールを使って、今回は特に依存パッケージのインストールをテストします。</p>

<p>早速設定ファイルを編集してchroot環境で使うシステムイメージを作ります。<br/>
今回は <code>cowbuilder</code> というものを使います。CopyOnWriteで早いらしいですよくわかりません！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cat ~/.pbuilderrc 
</span><span class='line'>PDEBUILD_PBUILDER=cowbuilder
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cowbuilder --create</span></code></pre></td></tr></table></div></figure>


<p>そして <code>pdebuild</code> コマンドでビルドテストを行います。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cat debian/control 
</span><span class='line'>...
</span><span class='line'>Build-Depends: debhelper (&gt;= 9.0.0)
</span><span class='line'>...
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# pdebuild 
</span><span class='line'>...
</span><span class='line'>dh clean  --with autotools-dev
</span><span class='line'>dh: unable to load addon autotools-dev: Can't locate Debian/Debhelper/Sequence/autotools_dev.pm in @INC (@INC contains: /etc/perl /usr/local/lib/perl/5.14.2 /usr/local/share/perl/5.14.2 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.14 /usr/share/perl/5.14 /usr/local/lib/site_perl .) at (eval 3) line 2.
</span><span class='line'>BEGIN failed--compilation aborted at (eval 3) line 2.
</span><span class='line'>
</span><span class='line'>make: *** [clean] Error 2
</span><span class='line'>dpkg-buildpackage: error: fakeroot debian/rules clean gave error exit status 2
</span><span class='line'>E: Failed autobuilding of package
</span><span class='line'>…</span></code></pre></td></tr></table></div></figure>


<p>見覚えのあるエラーでコケました。<br/>
<code>debian/control</code> ファイルに依存関係を追加して再度ビルドテストしてみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cat debian/control 
</span><span class='line'>...
</span><span class='line'>Build-Depends: debhelper (&gt;= 9.0.0), autotools-dev
</span><span class='line'>...
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# pdebuild 
</span><span class='line'>checking dependency style of g++... none
</span><span class='line'>checking for pkg-config... no
</span><span class='line'>checking for SIGC... no
</span><span class='line'>configure: error: in `/tmp/buildd/hello-cwidget-20120922':
</span><span class='line'>configure: error: The pkg-config script could not be found or is too old.  Make sure it
</span><span class='line'>is in your PATH or set the PKG_CONFIG environment variable to the full
</span><span class='line'>path to pkg-config.
</span><span class='line'>...
</span><span class='line'>configure: exit 1
</span><span class='line'>dh_auto_configure: ./configure --build=x86_64-linux-gnu --prefix=/usr --includedir=${prefix}/include --mandir=${prefix}/share/man --infodir=${prefix}/share/info --sysconfdir=/etc --localstatedir=/var --libexecdir=${prefix}/lib/hello-cwidget --disable-maintainer-mode --disable-dependency-tracking returned exit code 1
</span><span class='line'>make: *** [build] Error 25
</span><span class='line'>dpkg-buildpackage: error: debian/rules build gave error exit status 2
</span><span class='line'>E: Failed autobuilding of package
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p><code>debian/control</code> ファイルに依存関係を追加して（ry</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cat debian/control 
</span><span class='line'>...
</span><span class='line'>Build-Depends: debhelper (&gt;= 9.0.0), autotools-dev, libcwidget-dev
</span><span class='line'>...
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# pdebuild </span></code></pre></td></tr></table></div></figure>


<p>成功しました！<br/>
これでインストール時に依存パッケージも入れてくれるようになりました。</p>

<h2>パッケージビルド</h2>

<p>では改めて <code>debuild</code> コマンドでパッケージをビルドします。<br/>
オプションの <code>-us</code> はソースパッケージにPGP署名を行わない、 <code>-uc</code> は.changesファイルにPGP署名を行わないという意味になるようです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# debuild -us -uc</span></code></pre></td></tr></table></div></figure>


<p>1つ上のディレクトリを見てみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ls -l ..
</span><span class='line'>合計 208
</span><span class='line'>drwxr-xr-x 3 mazgi mazgi  4096  9月 22 14:24 hello-cwidget-20120922
</span><span class='line'>-rw-r--r-- 1 root  root  84299  9月 22 09:38 hello-cwidget-20120922.tar.gz
</span><span class='line'>-rw-r--r-- 1 root  root   1779  9月 22 14:24 hello-cwidget_20120922-1.debian.tar.gz
</span><span class='line'>-rw-r--r-- 1 root  root    915  9月 22 14:24 hello-cwidget_20120922-1.dsc
</span><span class='line'>-rw-r--r-- 1 root  root   6616  9月 22 14:24 hello-cwidget_20120922-1_amd64.build
</span><span class='line'>-rw-r--r-- 1 root  root   1637  9月 22 14:24 hello-cwidget_20120922-1_amd64.changes
</span><span class='line'>-rw-r--r-- 1 root  root   7134  9月 22 14:24 hello-cwidget_20120922-1_amd64.deb
</span><span class='line'>-rw-r--r-- 1 root  root   1357  9月 22 14:18 hello-cwidget_20120922-1_source.changes
</span><span class='line'>-rw-r--r-- 1 root  root  84280  9月 22 11:57 hello-cwidget_20120922.orig.tar.gz</span></code></pre></td></tr></table></div></figure>


<p>無事debファイルができています。</p>

<h2>パッケージインストール／アンインストールテスト</h2>

<p><code>piuparts</code> というツールでインストールとアンインストールのテストができるようです。<br/>
パッケージビルドで使用した<code>pdebuild</code> と同じようにchrootしてsandboxを提供してくれるようです。</p>

<p><code>pbuilder</code> にはCopyOnWriteで高速動作する <code>cowbuilder</code> がありますが、 <code>piuparts</code> のCopyOnWrite版は目下開発中のようです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# piuparts -d unstable ../hello-cwidget_20120922-1_amd64.deb 
</span><span class='line'>…
</span><span class='line'>7m52.2s INFO: PASS: All tests.
</span><span class='line'>7m52.2s INFO: piuparts run ends.</span></code></pre></td></tr></table></div></figure>


<h2>パッケージの修正</h2>

<p>今回のサンプルパッケージには、大変ありがたいことにtypoが <em>用意されている</em> ので修正してみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# grep -r Debain
</span><span class='line'>hello-cwidget.cc:     dialogs::ok(L"Hello, Debain Dojo!",</span></code></pre></td></tr></table></div></figure>


<p>&#8220;Debain&#8221;を&#8221;Debian&#8221;に修正してみます。</p>

<h3>patchをつくる</h3>

<p>typoを修正して、 <code>dpkg-source --commit</code> コマンドでパッチを作ります。楽チンですね。</p>

<p><code>dpkg-source --commit</code> コマンドは元のtarballを基準としてパッチを作るようです。<br/>
gitでいうところの<code>git init</code> 的な操作はいらないのかな？と不思議だったのですが、教えていただきました。<br/>
Makefileの書き方次第ではパッチにゴミが混じることがあるようなので、 <code>debuild</code> コマンドでcleanしたり、 <code>debclean</code> コマンドを実行してお掃除した方がいいようです。<br/>
今回は <code>./debian/rules clean</code> しちゃいましたが、この辺りサッパリ理解してないので必要に迫られたら調べたいです。</p>

<p>また、パッケージ自体のバージョン管理にはSubversionのような集中リポジトリ型より分散型のVCSの方が相性良いとのことです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# ./debian/rules clean
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# vi hello-cwidget.cc 
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# EDITOR=vi dpkg-source --commit
</span><span class='line'>dpkg-source: info: local changes detected, the modified files are:
</span><span class='line'> hello-cwidget-20120922/hello-cwidget.cc
</span><span class='line'>Enter the desired patch name: fix typo
</span><span class='line'>…
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cat debian/patches/series 
</span><span class='line'>fix-typo</span></code></pre></td></tr></table></div></figure>


<p>patchの内容はこんな感じです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# cat debian/patches/fix-typo 
</span><span class='line'>Description: Fixed message in dialog
</span><span class='line'> This patch is fixed typo from Debain to Debian.
</span><span class='line'> .
</span><span class='line'> hello-cwidget (20120922-1) unstable; urgency=low
</span><span class='line'> .
</span><span class='line'>   * Initial release (Closes: #nnnn)  &lt;nnnn is the bug number of your ITP&gt;
</span><span class='line'>Author: Hidenori MATSUKI &lt;MATSUKI.Hidenori@gmail.com&gt;
</span><span class='line'>
</span><span class='line'>---
</span><span class='line'>The information above should follow the Patch Tagging Guidelines, please
</span><span class='line'>checkout http://dep.debian.net/deps/dep3/ to learn about the format. Here
</span><span class='line'>are templates for supplementary fields that you might want to add:
</span><span class='line'>
</span><span class='line'>Origin: Other
</span><span class='line'>Forwarded: not-needed
</span><span class='line'>Last-Update: 2012-09-22
</span><span class='line'>
</span><span class='line'>--- hello-cwidget-20120922.orig/hello-cwidget.cc
</span><span class='line'>+++ hello-cwidget-20120922/hello-cwidget.cc
</span><span class='line'>@@ -35,7 +35,7 @@ int main(int argc, char **argv)
</span><span class='line'>  toplevel::init();
</span><span class='line'> 
</span><span class='line'>  widgets::widget_ref dialog =
</span><span class='line'>-     dialogs::ok(L"Hello, Debain Dojo!",
</span><span class='line'>+     dialogs::ok(L"Hello, Debian Dojo!",
</span><span class='line'>          util::arg(sigc::ptr_fun(toplevel::exitmain)));
</span><span class='line'> 
</span><span class='line'>  toplevel::settoplevel(dialog);</span></code></pre></td></tr></table></div></figure>


<p>再度 <code>debuild</code> コマンドを実行します。<br/>
どうやら <code>dpkg-source</code> が実行されてパッチが当たるようです。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# debuild -us -uc
</span><span class='line'>…
</span><span class='line'>dpkg-source: info: applying fix-typo
</span><span class='line'>…
</span><span class='line'>Finished running lintian.</span></code></pre></td></tr></table></div></figure>


<p><code>debi</code> で更新されたパッケージをインストールしてみます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# debi 
</span><span class='line'>(データベースを読み込んでいます ... 現在 61017 個のファイルとディレクトリがインストールされています。)
</span><span class='line'>hello-cwidget 20120922-1 を (hello-cwidget_20120922-1_amd64.deb で) 置換するための準備をしています ...
</span><span class='line'>hello-cwidget を展開し、置換しています...
</span><span class='line'>hello-cwidget (20120922-1) を設定しています ...
</span><span class='line'>root@debian-sid:~/debian/dojo/work/hello-cwidget-20120922# hello-cwidget </span></code></pre></td></tr></table></div></figure>


<p><img src="/images/2012-09-22-debian-dojo/20120922_hello-cwidget_02.png"></p>

<p>ちゃんと&#8221;Debain&#8221;が&#8221;Debian&#8221;に直っていますね！<br/>
どうやら <code>debi</code> コマンドでインストールすると同じバージョンのパッケージでも置き換えられるようです。</p>

<h1>Ruby1.9.3をパッケージングしてみる…</h1>

<p>さていよいよRuby1.9.3のパッケージングに挑戦です！<br/>
これが目的で参加させていただいたのでした。</p>

<p>まずはtarball持ってきてビルドできることを確認…</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@debian-sid:~/debian/dojo/work.ruby# pwd
</span><span class='line'>/root/debian/dojo/work.ruby
</span><span class='line'>root@debian-sid:~/debian/dojo/work.ruby# curl -LO ftp://ftp.ruby-lang.org/pub/ruby/1.9/ruby-1.9.3-p194.tar.bz2
</span><span class='line'>root@debian-sid:~/debian/dojo/work.ruby# tar xf ruby-1.9.3-p194.tar.bz2 
</span><span class='line'>root@debian-sid:~/debian/dojo/work.ruby# cd ruby-1.9.3-p194/
</span><span class='line'>root@debian-sid:~/debian/dojo/work.ruby/ruby-1.9.3-p194# ./configure 
</span><span class='line'>root@debian-sid:~/debian/dojo/work.ruby/ruby-1.9.3-p194# make
</span><span class='line'>root@debian-sid:~/debian/dojo/work.ruby/ruby-1.9.3-p194# make check</span></code></pre></td></tr></table></div></figure>


<p>…してたら <code>make check</code> 終わらずに時間切れ。</p>

<p>今回ここまででした。。</p>

<h1>感想と教えていただいたこと</h1>

<p>成果発表の時間に&#8221;前に立って質問する&#8221;という前代未聞の方法でいろいろ教えていただいたのでメモ。</p>

<ul>
<li>感じたDebian文化

<ul>
<li>「それはFreeじゃない」とか聴こえてきてさすがDebian GNU/Linuxだなと思いました。</li>
<li>(Debianに限らないけど)対象のライセンスは皆さんものすごく気にされてて「見習わないと！」と思いました。</li>
</ul>
</li>
<li>Rubyパッケージについて

<ul>
<li><a href="http://packages.debian.org/ja/sid/libruby">libruby</a>あるそうです！…ｏｒｚ</li>
<li>「rubyをビルドするなら、debian用のtarball使ったほうが楽だよ！」と教えていただきました、感謝。</li>
</ul>
</li>
<li>mikutterパッケージ作った方が！ <a href="https://github.com/upsilon/mikutter-deb">upsilon/mikutter-deb</a>

<ul>
<li>Debianコミュニティでもパッケージング中とのこと</li>
<li>アイコンは&#8221;みく&#8221;だそうです、なんだー初音ミクとは無関係なんですねー当たり前ですねっ</li>
<li>画像のライセンスはCC by SA3.0とのこと</li>
<li>音源もライセンス解決したorする見込みだそうです。</li>
<li>ライセンス問題全部解決したので晴れてパッケージになる！らしいです。</li>
</ul>
</li>
<li>PHPにも<a href="http://getcomposer.org/">Composer</a>というRubyのbundlerぽいのがあるらしいです、知らなかった。</li>
</ul>


<p>環境構築で手間取って聞き漏らしたり理解しきれなかったところも多いのですが、debファイルがちょっとだけ身近に感じられるようになりました。
皆さん本当にありがとうございました！</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">mazgi</span></span>

      








  


<time datetime="2012-09-22T16:54:00+09:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/debian/'>Debian</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://b.hatena.ne.jp/entry/http://mazgi.github.com/blog/2012/09/22/debian-dojo/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard" title="Add this entry to your Hatena :: Bookmark">
    <img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="Add this entry to your Hatena :: Bookmark" width="20" height="20" style="border: none;" />
  </a>
  <script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://mazgi.github.com/blog/2012/09/22/debian-dojo/" data-via="" data-counturl="http://mazgi.github.com/blog/2012/09/22/debian-dojo/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2012/10/11/installing-jira/" title="Next Post: さくらVPSにJIRAをインストールしてみました">さくらVPSにJIRAをインストールしてみました &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/10/11/installing-jira/">さくらVPSにJIRAをインストールしてみました</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/22/debian-dojo/">「第0回Debianパッケージング道場」に行ってきました</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - mazgi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
